var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AutoSuggest;(function(n){var t;(function(t){function wi(n,t){var r=[],u,f;if(t)if(n)r=t.slice();else{u=function(n){var i=t.find(function(t){return t.verb&&t.verb.toLocaleLowerCase()==n.toLocaleLowerCase()});i&&r.push(i)};for(f in i)u(f)}return r}function bi(n){return n?n.filter(function(n){return!n.verb||n.verb.toLowerCase()!="open"}):[]}function e(n,i,r,u,f,e){e()&&(n=n.slice(),i.getExtraVerbsAsync?t.Promise.safeChain("getExtraVerbsAsync",function(){return i.getExtraVerbsAsync(u)},function(t){return h(d(n,t,!0),i,u,f,e)},function(){return h(n,i,u,f,e)},null,r):h(n,i,u,f,e))}function h(n,t,i,r,u){if(u()){var f=t.getExtraVerbs?d(n,t.getExtraVerbs(i),!1):n;f[0]==y&&f.shift();r(f)}}function ki(n,r,u,f,e){return n.map(function(n){var o,s,h,c;if(n.verb){switch(n.verb.toLocaleLowerCase()){case lt:o="PinnedToStart";break;case b:o="PinnedToTaskbar";break;case at:o="UnpinnedFromStart";break;case k:o="UnpinnedFromTaskbar";break;case ct:s="UninstallConfirmation";o="UninstallationInProgress"}return h=function(i){i();t.RuntimeConfig.AlwaysWide&&o=="UninstallationInProgress"?(r.uninstallationInProgress=!0,e&&e()):o?u.showTemporaryMessage(f.getLocString(o,HitHighlightingParser.removeMarkers(r.text))):u.hideTemporaryMessage();n.verb.toLocaleLowerCase()==b&&f.addItemToPinnedToTaskbar(r.deviceItem.id);n.verb.toLocaleLowerCase()==k&&f.removeItemFromPinnedToTaskbar(r.deviceItem.id)},c=n.icon||i[n.verb.toLocaleLowerCase()],new t.DeviceItemVerbWrapper(n,c,function(i){s&&t.DialogBox?t.DialogBox.show(f.getLocString(s),[{id:null,text:n.displayName,action:function(){return h(i)},selected:!1},{id:null,text:f.getLocString("Cancel"),selected:!0}]):h(i)})}return n})}function vt(n,i,r,u,f,o){if(t.isJumpListSuggestion(i))return t.Promise.safeChain("jumpListItem.getVerbsAsync",function(){return i.jumpListItem.getVerbsAsync()},function(n){return e(bi(n),i,s,u,f,o)},function(){return e([],i,s,u,f,o)},null,n+" "+i.type),!0;var s=n+" "+i.type,c=t.getItemWithFileMetadata(i);return c&&c.canHaveContextMenu?(t.Promise.safeChain("getVerbsAsync",function(){return c.getVerbsAsync()},function(n){return e(wi(r,n),i,s,u,f,o)},function(){return e([],i,s,u,f,o)},null,s),!0):i.getExtraVerbsAsync?(e([],i,s,u,f,o),!0):i.getExtraVerbs?(h([],i,u,f,o),!0):(u&&f([]),!1)}function o(n,i,r){if(i==t.GroupType.EdgeHistory&&!r)return!1;var u=HitHighlightingParser.removeMarkers(n.text),f=u?u.length:0;return n.additionalInfoText&&!r&&(f+=n.additionalInfoText.length),f>(r?yi:pi)}function yt(n){for(var i,r={topResults:n.topResults.slice(0),groups:[]},t=0,u=n.groups;t<u.length;t++)i=u[t],r.groups.push({typeWithSource:i.typeWithSource,suggestions:i.suggestions.slice(0)});return r}function pt(n,i){if(n.isHtmlAnswer)return fi;if(n.grid)return(i?t.IconSize_GridLayout:t.IconSize_GridLayout_Medium)+2*u;var f=t.config.verticalScanPattern?96:ui,r=n.numberOfLines==3?f:n.numberOfLines==2?ri:ii;return n.mainTextWrapsToTwoLines&&(r+=ut),r<rt&&(r=rt),r}function di(n,i){if(i&&t.uses3lineTemplate(t.getScope(i.type)))return pt({mainTextWrapsToTwoLines:!1,numberOfLines:3,isHtmlAnswer:!1,isSuppressed:n.isSuppressed,grid:!1},!1);if(n.isSuppressed)return 0;var r=ni;return n.hasTwoLines?r+=l+2:n.mainTextWrapsToTwoLines&&(r+=ut),r}function gi(n,i){var r=it;if(i.typeWithSource&&t.displayedInGridLayout(i.typeWithSource.type)){var u=t.isL2(n),f=Math.ceil(i.suggestions.length/(u?st:ht)),e=u?ft:et;r+=e*f;r+=2*a}else i.suggestions.forEach(function(n){return r+=di(n,i.typeWithSource)});return r}function nr(n){switch(n){case 0:return"CP";case 7:return"DI";case 1:return"PP";case 2:return"PD";case 4:return"SP";case 5:return"TP";case 6:return"SD"}return undefined}function d(n,t,i){if(n.length>0&&t.length>0){var r=i?n.concat(y):n;return r.concat(t)}return n.length>0?n:t.length>0?i?[y].concat(t):t:[]}function r(n,i){return n.find(function(n){return t.sameGroup(n.typeWithSource,i)})}function wt(n,i){return n.find(function(n){return t.sameGroup(n.group.typeWithSource,i)})}function bt(n,t){return n.queryToFetch.substring(0,t.queryToFetch.lastIndexOf("\\"))}function kt(n){switch(n){case t.GroupType.TopApps:case t.GroupType.People:return!0}return!1}function tr(n,i,r){return!n.isSearchHomeZI||n.scope==t.Scope.All?null:kt(r)?i.getLocString("FrequentSection"):i.getLocString("RecentSection")}function dt(n,i,r,u,f){var s,o,e,h,c;if(r==t.GroupType.PathCompletion)return s=bt(n,n)+"\\"+String.fromCharCode(8206),{title:s,narratorText:s};if(u&&(o=u.groupDisplayName,o))return{title:o,narratorText:f?i.getLocString("AddingScopeNarratorText",o):o};if(e=tr(n,i,r),!e)switch(r){case t.GroupType.Command:e=i.getLocString("CommandGroup");break;case t.GroupType.Cortana:e=t.config.useCortanaGroupString?i.getLocString("CortanaGroup"):i.getLocString("CortanaArchivedMessageGroup");break;case t.GroupType.Store:e=i.getLocString("StoreGroup");break;case t.GroupType.PowerBi:e="Power BI";break;case t.GroupType.EdgeHistory:e=i.getLocString("EdgeHistoryGroup");break;case t.GroupType.LocalPlaces:e=i.getLocString("LocalPlacesGroup");break;case t.GroupType.Related:e=i.getLocString("RelatedSuggestionsGroup");break;case t.GroupType.SearchSuggestions:e=t.getWebSuggestionsGroupHeader(i);break;case t.GroupType.Websites:e=t.getWebsitesGroupHeader(i);break;case t.GroupType.Contact:e=i.getLocString("ContactGroup");break;case t.GroupType.StartMenu:e="Start menu";break;case t.GroupType.LocalSearchHistory:e="Search history";break;case t.GroupType.ActivityFeedSuggestions:e=i.getLocString("RecentActivitiesSection");break;case t.GroupType.TopApps:e=i.getLocString("TopAppsSection");break;case t.GroupType.QuickSearch:e=i.getLocString("LastSearchSection")}if(!e){if(h=t.getScope(r),h==t.Scope.All)throw new Error("Unknown group type: "+r);c=t.ScopeConfig[h];e=t.getScopeDisplayName(c,i)}return{title:e,narratorText:f?i.getLocString("AddingScopeNarratorText",e.toLocaleLowerCase()):e}}var g=4,nt=6,c=8,u=12,tt=1,f=20,l=16,ni=f+2*c,it=16+2*c,ti=it,rt=60,ii=f+2*u,ri=f+l+g+2*u,ui=f+2*(l+g)+2*u,fi=80+2*u,ei=c,ut=f,oi=48,a=1,ft=t.IconSize_GridLayout+2*(nt+tt),et=t.IconSize_GridLayout_Medium+2*(nt+tt),si=24,hi=12,ci=140,li=156,ai=8,vi=4,ot=200,st=3,ht=4,yi=39,pi=42,v=SearchAppWrapper.CortanaApp,y={},p="runas",w="tabletmode_opennewwindow",ct="tile.uninstall",lt="startpin",b="taskbarpin",at="startunpin",k="taskbarunpin",s={id:"SearchBox",selected:!1,text:"SearchBox"},i={},gt;i[p]={content:"&#xE7EF",type:1};i.runasuser={content:"&#xE7EE",type:1};i.openinbrowser={content:"&#xE774",type:1};i.openfilelocation={content:"&#xE838",type:2};i.opencontaining={content:"&#xE838",type:2};i[w]={content:"&#xE8A7",type:2};i[at]={content:"&#xE77A",type:1};i[k]={content:"&#xE77A",type:1};i[lt]={content:"&#xE718",type:2};i[b]={content:"&#xE718",type:2};i.settings={content:"&#xE713",type:2};i.manage={content:"&#xE912",type:1};i.review={content:"&#xE728",type:2};i.share={content:"&#xE72D",type:1};i.connectnetworkdrive={content:"&#xE8CE",type:1};i.disconnectnetworkdrive={content:"&#xE8CD",type:1};i.uninstall={content:"&#xE74D",type:2};i[ct]={content:"&#xE74D",type:2};i.itemproperties={content:"&#xF106",type:2};t.config.extraActions&&(i.copy={content:"&#xE8C8",type:1},i.print={content:"&#xE749",type:1},i.properties={content:"&#xE946",type:2},i.edit={content:"&#xE70F",type:2},i.shelledit={content:"&#xE70F",type:2},i["3d edit"]={content:"&#xE70F",type:2});t.extendVerbs=ki;t.getVerbsAsync=vt;t.wrapsToTwoLines=o;t.joinVerbs=d;t.getGroupTitleAndNarratorText=dt;gt=function(i){function u(r,u,f,e,o,s,h,c,l){var a=i.call(this,r,f,e,s)||this;return a._host=r,a._autoComplete=u,a._navigationHelper=o,a._headerFooterViewModel=h,a._previewPane=c,a._menuFactory=l,a._pendingSubmitSequenceNumber=-1,a._pendingSubmitModifierKeys=null,a._pendingSubmitTimeStamp=null,a._resultsCounter={topResults:[],groups:[]},a._pendingSuggestionsInExistingGroups=[],a._pendingSuggestionsInMissingGroups=[],s.setSuggestionClickHandler(a.doubleClickGuardedHandler(function(t,i){n.safeExecute(function(){return a.click(n.getCurrentTime(),t,n.getInputType(i),null)},"suggestionClickHandler")})),s.setContextMenuHandler(function(t,i){n.safeExecute(function(){return a._menuFactory.showContextMenuOnXY(t,i.pageX,i.pageY,function(){return a._host.setFocusInSearchBox(null,"contextMenuDismiss")})},"contextMenuHandler")}),s.setOpenPreviewPaneClickHandler(function(t,i){n.safeExecute(function(){return a.openPreviewPane(t,i)},"openPreviewPaneClickHandler")}),s.setExpanderClickInstrumentation(function(n,t,i){var r="Expander"+(i?"Opened":"Closed"),u={st:t,K:n.instItem.getLayoutKValue()};a._instrumentationHelper.logClientInstEvent("Select",r,null,u)}),a._previewPane&&(a._previewPane.init(a),a._previewPane.bindBeforeItemLaunch(function(n,t,i,r,u){return a._instrumentationHelper.instrumentItemClick(n,t.instItem,t.sequenceNumber,t.instrumentPingBack,i,null,null,r,u)}),a._previewPane.bindAfterItemLaunch(function(n,t,i){return a.onSuggestionLaunch(n,t,i)})),r.bindKeyUp(function(n,t,i){return a.onKeyUp(n,t,i)}),r.bindShown(function(){!t.isMobileCache&&v.queryFormulationView.deviceSearch.getSearchServiceStatusAsync&&t.Promise.safeChain("getSearchServiceStatusAsync",function(){return v.queryFormulationView.deviceSearch.getSearchServiceStatusAsync()},function(n){a._instrumentationHelper.setSearchServiceStatus(nr(n));n!=0&&n!=4&&n!=3&&n!=7&&a.showIndexingMessage(!1)})}),r.bindDismissed(function(){a._pendingSuggestionsInExistingGroups=[];a._pendingSuggestionsInMissingGroups=[];a.toggleProgressBar(!1);a._menuFactory.dismiss();a._previewPane&&t.RuntimeConfig.PreviewPaneAvailable&&a._previewPane.dismiss();a._page.hideTemporaryMessage();a.hideIndexingMessage();t.DialogBox&&t.DialogBox.hide();a._headerFooterViewModel.render(null,!1,!1,!1,!0);t.config.glyphInSearchBox&&a._host.setSearchBoxGlyphIcon()}),s.bindOnNarratorLaunch(function(t){for(var i,f=n.getCurrentTime(),e=a.getSelectableItems(),r=0,u=e;r<u.length;r++)if(i=u[r],i.id==t){a.isSuggestionOrGroup(i)?(a.select(i,!1),a.submit(f,!1,i.sequenceNumber,null,!0)):a._headerFooterViewModel.isScopeElement(i)&&_ge(i.id).click();break}}),a._headerFooterViewModel.bindOnL2TransitionEnd(function(){return a.resetAriaSelected(a.getSelectedItem())}),t.config.searchBoxFocusEvents&&(r.bindSearchBoxGotFocus(function(){a._menuFactory.dismiss();var t=n.getCurrentActiveElement();t&&t.blur();(a._headerFooterViewModel.isScopesL2Visible()||a._selectedItem&&!a._headerFooterViewModel.isScopeElement(a._selectedItem))&&a.renderSelectedSuggestionState(!1)}),r.bindSearchBoxLostFocus(function(){var i=t.isScopeTile(n.getCurrentActiveElement());i?n.safeSetTimeout(function(){a._host.searchBoxHasFocus()||a._headerFooterViewModel.isScopeElement(a._selectedItem)||a.renderSelectedSuggestionState(!0)},75,"RootViewModel.bindSearchBoxLostFocus"):a.renderSelectedSuggestionState(!0)})),sj_evt.bind("CortanaPaneWidthSet",function(n){return a.onPaneWidthSet(n[1])}),sj_be(_ge("qfContainer"),"scroll",function(){return a._menuFactory.dismiss()}),a}return __extends(u,i),u.prototype.onPaneWidthSet=function(n){ht=Math.floor((n-2*a)/et);st=Math.floor((n-2*a)/ft)},u.prototype.setSelectedStyleSuspended=function(n,t){n.selectedStyleSuspended=t&&this._host.isRequestFocusAvailable()},u.prototype.renderSelectedSuggestionState=function(n){this._selectedItem&&(this.setSelectedStyleSuspended(this._selectedItem,n),this.renderSelection(this._selectedItem))},u.prototype.toggleProgressBar=function(i){var r=this;t.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),i?(this._partialQuery.showProgressBar||this._partialQuery.queryToFetch=="")&&(this._progressTimer=n.safeSetTimeout(function(){r._progressTimer&&(r._page.setProgressIndicatorVisibility(!0),r._progressTimer=null)},250,"showProgress")):t.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),this._page.setProgressIndicatorVisibility(!1)))},u.prototype.resetPendingSubmitSequenceNumber=function(){this._pendingSubmitSequenceNumber=null;this._pendingSubmitModifierKeys=null;this._pendingSubmitTimeStamp=null},u.prototype.onAfterKeyDown=function(i,r,u,f){var v,o,y,p,c,l,a,s,w;if(!this._partialQuery||!this._menuFactory.isMenuVisible()&&i==13)return!1;var h=r&&r.shiftKey,e=this._previewPane&&this._previewPane.hasFocus();if(this._page.hideTemporaryMessage(),this.resetPendingSubmitSequenceNumber(),t.DialogBox&&t.DialogBox.isVisible()||this._headerFooterViewModel.isScopesL2Visible())return!0;if(!u&&n.isContextMenuKey(i,h)&&!this._headerFooterViewModel.isScopesL2Visible()&&!e)return this.tryShowContextMenuOnSelectedSuggestion(),!0;if(this._menuFactory.isMenuVisible()){if(i==37||i==39||i==13||n.isUpOrDownKey(i)){if(v=this._menuFactory.onAfterKeyDown(i,r,u,f),v)return!0;if(n.isUpOrDownKey(i))return!1}this._menuFactory.dismiss(!0)}if(o=n.getCurrentActiveElement(),!t.isScopeTile(o)||e||this._menuFactory.isMenuVisible()||i!=39&&i!=37){if(i==9)t.config.searchBoxFocusEvents?t.config.allowTabToSelectSuggestions||h||!this._selectedItem||e||this._headerFooterViewModel.isScopeElement(this._selectedItem)?f||this.handleCrossViewModelsTabKeyNavigation(o,h):this.select(this._headerFooterViewModel.getSelectableItems()[0],!1):o==_d.body?(this.select(this._headerFooterViewModel.getSelectableItems()[0],!1),r&&r.preventDefault&&r.preventDefault()):t.isScopeTile(o)&&(c=this.getSelectableItems(),c.length>0&&this.select(c[0],!0));else if(t.RuntimeConfig.PreviewPaneAvailable&&this._previewPane&&this._selectedItem&&!this._headerFooterViewModel.isScopeElement(this._selectedItem)){this._previewPane.onAfterKeyDownWhenNewSelection(i,this._partialQuery,this._selectedItem);if(e)return!0}}else y=t.getRtlAdjustedKey(i),this._headerFooterViewModel.focusNextScopeTile(o,y==39),p=this._headerFooterViewModel.getSelectableItems(),this.select(p[0],!1);return e=this._previewPane&&this._previewPane.hasFocus(),this._selectedItem&&(n.isUpOrDownKey(i)||i==9)&&!e&&(l=this._headerFooterViewModel.isScopeElement(this._selectedItem),l||this._selectedItem==this.topResults[0]?this._page.scrollToTop():this._page.scrollTo(this._selectedItem),a="rvm onAfterKeyDown-AdjustFocus",l||this.isAdvancedOption(this._selectedItem)?(this.isAdvancedOption(this._selectedItem)?_ge(this._selectedItem.id).querySelector("input").focus():_ge(this._selectedItem.id).focus(),this._host.searchBoxHasFocus()&&this._host.setFocusInWebView(a)):i!=9&&this._host.searchBoxHasFocus()||this._host.setFocusInSearchBox(i,a)),t.config.forceTypedQueryOnTopSupported&&i==46&&this._partialQuery&&this._selectedItem&&this._selectedItem===this.topResults[0]&&this.topResults[0].query.toLocaleLowerCase()!=this._partialQuery.queryToFetch.toLocaleLowerCase()&&(s=this._host.getQuery(),s.originalQuery==this._partialQuery.originalQuery&&(w=s.originalCursorPosition==s.originalQuery.length,w&&this._host.reformulate(this._partialQuery.originalQuery,null,1))),!1},u.prototype.handleCrossViewModelsTabKeyNavigation=function(i,r){var a=this,v=t.RuntimeConfig.PreviewPaneAvailable&&!!this._previewPane,o=v&&this._previewPane.isOpened(),y=o&&this._previewPane.hasFocus(),s,f,l,u,h,c,e;y?r?(this._previewPane.blur(),s=this._headerFooterViewModel.getSelectableItemsByGroup(),e=s[s.length-1][0],this.select(e,!1)):(this._previewPane.blur(),u=this.getSelectableItems(),this.select(u[0],!0)):t.isScopeTile(i)?!o||r?(f=this.getSelectableSuggestionsByGroup(!0),f.length>0?(l=r?f[f.length-1][0]:f[0][0],this.select(l,!0)):(u=this.getSelectableItems(),u.length>0?this.select(u[0],!0):this.select(null,!0)),h="handleCrossBordersNavigationWithTab",n.safeSetTimeout(function(){return a._host.setFocusInSearchBox(9,h)},0,h)):(this.select(this._previewPane.getPreviewedSuggestion(),!0),this._previewPane.focus(!0)):this._selectedItem?r?o?this._previewPane.focus():(c=this.getSelectableItemsByGroup(),e=c[c.length-1][0],this.select(e,!1)):this.select(this.getSelectableItemsByGroup()[0][0],!1):this.select(this.getSelectableItemsByGroup()[0][0],!1)},u.prototype.onKeyUp=function(i){if(i==9&&this._selectedItem&&!t.config.searchBoxFocusEvents){var r=n.getCurrentActiveElement();this.renderSelectedSuggestionState(!t.isBodyOrSuggestion(r));return}},u.prototype.tryShowContextMenuOnSelectedSuggestion=function(){var i=this,t=this._selectedItem&&this.isSuggestion(this._selectedItem)?this._selectedItem:null;t&&n.safeExecute(function(){return i._menuFactory.showContextMenuOnElement(t,_ge(t.id),function(){return i._host.setFocusInSearchBox(null,"contextMenuDismiss")})},"contextMenuHandler")},u.prototype.onQueryChanged=function(r,u){var c=this,l,e,p,w,b,o,s,a,v,h,y,f;if(t.DialogBox&&t.DialogBox.hide(),this._menuFactory.dismiss(),!this._partialQuery||!this._partialQuery.equals(r)){if(this._page.hideTemporaryMessage(),t.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),r.showProgressBar?this._progressTimer=n.safeSetTimeout(function(){c._progressTimer&&(c._page.setProgressIndicatorVisibility(!0),c._progressTimer=null)},250,"showProgress"):this._page.setProgressIndicatorVisibility(!1)),this._partialQuery&&this._partialQuery.scope!=r.scope&&(this._turnOnIndexingInstItem||this.hideIndexingMessage()),l=this._partialQuery?this._partialQuery.queryToFetch:"",e=r.queryToFetch,this._previewPane&&t.RuntimeConfig.PreviewPaneAvailable)this._previewPane.onQueryChanged(r);for(p=this._partialQuery?this._partialQuery.scope:t.Scope.All,i.prototype.onQueryChanged.call(this,r,u),w=t.config.glyphInSearchBox==1,w&&r.scope!=p&&(b=t.ScopeConfig[r.scope],r.scope==t.Scope.All?this._host.setSearchBoxGlyphIcon():this._host.setSearchBoxGlyphIcon(b.icon)),o=!1,s=0,a=this.topResults;s<a.length;s++)f=a[s],f.updateFromQuery&&!f.hasPreviewPaneOpened?f.updateFromQuery(r)&&(o=!0):e.length>l.length&&e.startsWith(l)&&f.query.toLowerCase().includes(r.queryToFetch.toLowerCase())&&(v=f.text.indexOf(HitHighlightingParser.endMarker),v>=0&&v<f.text.length-1&&(f.text=HitHighlightingParser.addMarkers(HitHighlightingParser.removeMarkers(f.text),e),o=!0));if(o){for(h=0,y=this.topResults;h<y.length;h++)f=y[h],f.sequenceNumber=u,this.updateNarratorWithPreviewMessage(f);this.renderTopResults()}}},u.prototype.onSuggestionsParsed=function(n,i,r,u,f){var s=n.enabledDataSources[r].groupType,e,o,h;if(typeof s=="number")for(e=0,o=f;e<o.length;e++)h=o[e],h.staticGroupType=s;(u==="NI"||u==="PI")&&(r=="PP"||r=="ST"||n.scope!=t.Scope.All)&&n.scope!=t.Scope.Web&&this.showIndexingMessage(!0)},u.prototype.areSuggestionsPresent=function(){return this.topResults.length>0||this.groups.length>0&&this.groups.some(function(n){return n.suggestions.length>0})},u.prototype.getSuggestions=function(n){var t=this.getCurrentTopResults();return this.groups.forEach(function(n){return t=t.concat(n.suggestions)}),n&&(this._pendingSuggestionsInExistingGroups.forEach(function(n){return t=t.concat(n.suggestions)}),this._pendingSuggestionsInMissingGroups.forEach(function(n){return t=t.concat(n.suggestions)})),t},u.prototype.getSelectableItems=function(){var n,i,u,r;if(t.DialogBox&&t.DialogBox.isVisible())return t.DialogBox.getSelectableItems();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItems();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItems();if(this._headerFooterViewModel.isScopesL2Visible())return this._headerFooterViewModel.getSelectableItems();for(n=[],n.push.apply(n,this.topResults),i=0,u=this.groups;i<u.length;i++)r=u[i],r.click&&n.push(r),n.push.apply(n,r.suggestions.filter(function(n){return!n.suppressed}));return this.areSuggestionsPresent()||n.push(s),t.config.allowUpForScopes&&n.push.apply(n,this._headerFooterViewModel.getSelectableItems()),n},u.prototype.getSelectableSuggestionsByGroup=function(n){if(t.config.allowTabToSelectSuggestions){var i=[];return i.push(this.topResults),this.groups.forEach(function(n){n.click&&i.push([n]);i.push(n.suggestions.filter(function(n){return!n.suppressed}))}),n||i.push(this._headerFooterViewModel.getSelectableItems()),i.filter(function(n){return n.length>0})}return[]},u.prototype.getSelectableItemsByGroup=function(){if(t.DialogBox&&t.DialogBox.isVisible())return t.DialogBox.getSelectableItemsByGroup();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItemsByGroup();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItemsByGroup();var n=[];return n.push.apply(n,this._headerFooterViewModel.getSelectableItemsByGroup()),this._previewPane&&n.push.apply(n,this._previewPane.getSelectableItemsByGroup()),this._headerFooterViewModel.isScopesL2Visible()||(this.areSuggestionsPresent()?n.push.apply(n,this.getSelectableSuggestionsByGroup(!0)):n.push([s])),n},u.prototype.getSelectedItem=function(){return t.DialogBox&&t.DialogBox.isVisible()?t.DialogBox.getSelectedItem():this._menuFactory.isMenuVisible()?this._menuFactory.getSelectedItem():this._previewPane&&this._previewPane.hasFocus()?this._previewPane.getSelectedItem():this._headerFooterViewModel.isScopesL2Visible()?this._headerFooterViewModel.getSelectedItem():this._selectedItem?this._selectedItem:s},u.prototype.updateSelectionState=function(t){n.contains(this.topResults,t)?this.renderTopResults():this.groups.some(function(i){return n.contains(i.suggestions,t)})&&this.renderGroups()},u.prototype.renderSelection=function(i,r){(i&&this.isSuggestion(i)&&n.contains(this.topResults,i)||r&&this.isSuggestion(r)&&n.contains(this.topResults,r))&&this.renderTopResults();(i&&this.isAdvancedOption(i)||r&&this.isAdvancedOption(r))&&this._headerFooterViewModel.updateTopHitHeader();(i&&t.isGroup(i)&&n.contains(this.groups,i)||i&&this.isSuggestion(i)&&this.groups.some(function(t){return n.contains(t.suggestions,i)})||r&&t.isGroup(r)&&n.contains(this.groups,r)||r&&this.isSuggestion(r)&&this.groups.some(function(t){return n.contains(t.suggestions,r)}))&&this.renderGroups()},u.prototype.select=function(i,r){var u,e,f;t.DialogBox&&t.DialogBox.isVisible()?t.DialogBox.select(i):this._menuFactory.isMenuVisible()?this._menuFactory.select(i,!1):this._previewPane&&n.contains(this._previewPane.getSelectableItems(),i)?this._previewPane.select(i,!1):this._headerFooterViewModel.isScopesL2Visible()?this._headerFooterViewModel.select(i,!1):(u=this._selectedItem,u&&(u.selected=!1,this.setSelectedStyleSuspended(u,!1)),i==s?(this._selectedItem=null,this._host.searchBoxHasFocus()||this._host.setFocusInSearchBox(null,"rvm_select")):(this._selectedItem=i,i&&(i.selected=!0,this.setSelectedStyleSuspended(i,!this._host.searchBoxHasFocus()))),this.renderSelection(this._selectedItem,u),e=t.config.glyphInSearchBox==2,e&&this.setSearchBoxGlyphIcon(i),r&&(f=i?i.query:null,f&&this._partialQuery.scopePrefix&&(f=this._partialQuery.scopePrefix.trim()+": "+f),this._host.updateQueryWithoutRefetching(f)))},u.prototype.setSearchBoxGlyphIcon=function(i){var u,r,f,e;i&&(r=i.icon,r&&n.contains([2,1],r.type)?u=r:(f=t.isGroup(i)?i.typeWithSource.type:this.isSuggestion(i)?t.getGroupType(i):null,f!=null&&(e=t.getScope(f),u=e==t.Scope.All?null:t.ScopeConfig[e].icon)));this._host.setSearchBoxGlyphIcon(u)},u.prototype.renderTopResultsToUpdateIcons=function(){var i=this;t.config.delayRenderingForIcons?this._renderTopResultsTimerForIcons||(this._renderTopResultsTimerForIcons=n.safeSetTimeout(function(){i._renderTopResultsTimerForIcons=null;i.renderTopResults()},ot,"renderTopResultsToUpdateIcons")):this.renderTopResults()},u.prototype.renderGroupsToUpdateIcons=function(){var i=this;t.config.delayRenderingForIcons?this._renderGroupsTimerForIcons||(this._renderGroupsTimerForIcons=n.safeSetTimeout(function(){i._renderGroupsTimerForIcons=null;i.renderGroups()},ot,"renderGroups")):this.renderGroups()},u.prototype.setupIcon=function(i,r,u,f){var e=this,o;if(!r.suppressed&&r.getIcon)this._instrumentationHelper.notifyIconPending(i,u,r.instItem.getLayoutKValue(),r.type),o=this._partialQuery,r.getIcon(this.getImageSize(o,r,u),function(o){r.icon=o;var s=function(){e._partialQuery&&i==e._sequenceNumberReader.getSequenceNumber()&&(e._instrumentationHelper.notifyIconReady(i,u,r.instItem.getLayoutKValue(),r.type),u?n.contains(e.topResults,r)&&e.renderTopResultsToUpdateIcons():e.groups.some(function(t){return n.contains(t.suggestions,r)})&&e.renderGroupsToUpdateIcons(),f())};t.populateImageRatio(r.icon,r.type,s)});else if(!r.suppressed&&r.icon&&n.canIconFail(r.icon)){this._instrumentationHelper.notifyIconPending(i,u,r.instItem.getLayoutKValue(),r.type);var h=r.icon.getFallbackIcon,c=r.icon.isValidSize,s=function(){r.getIcon=h;e.setupIcon(i,r,u,f)};r.icon.onIconError=s;r.icon.onIconRendered=function(n,t){c(n,t)?f():s()};u?this.renderTopResultsToUpdateIcons():this.renderGroupsToUpdateIcons()}else f()},u.prototype.getImageSize=function(n,i,r){return n.isSearchHomeZI?i.type=="TOPL"?7:i.type=="AFC"?6:8:n.scope==t.Scope.Apps&&!n.queryToFetch?3:t.displayedInGridLayout(i.type)?2:r?0:1},u.prototype.isSuggestionOrGroup=function(n){return!this._headerFooterViewModel.isScopeElement(n)},u.prototype.isSuggestion=function(n){return!t.isGroup(n)&&!this._headerFooterViewModel.isScopeElement(n)&&!this.isAdvancedOption(n)},u.prototype.isAdvancedOption=function(n){return typeof n.layout=="number"},u.prototype.submit=function(i,r,u,f,e){var s=e?5:r?6:1,l=n.getCurrentActiveElement(),c,o,h,a;if(this._headerFooterViewModel.isScopesL2Visible()){if(c=this._headerFooterViewModel.getSelectedItem(),c){c.click(i,s,f);return}}else{if(this._selectedItem&&this._headerFooterViewModel.isScopeElement(this._selectedItem)&&!this._menuFactory.isMenuVisible()){_ge(this._selectedItem.id).click();return}if(t.DialogBox&&t.DialogBox.isVisible()){t.DialogBox.submit();return}if(this._previewPane&&this._previewPane.hasFocus()){if(o=this._previewPane.getSelectedItem(),o&&o.click&&o.optionType===undefined){o.click(i,s);return}}else if(t.RuntimeConfig.QfMode==5&&!this._selectedItem){this._host.submitFileExplorerTextSuggestion(this._partialQuery.queryToFetch);return}}if(h=this._menuFactory.getSelectedItem(),h){h.click&&h.click(i,s,f);return}if(a=!t.isBodyOrSuggestion(l),a){this._host.isRequestFocusAvailable()||l.click();return}if(this._lastUpdatedSequenceNumber!=u&&(!this._selectedItem||this._selectedItem==this.topResults[0])){this._pendingSubmitSequenceNumber=u;this._pendingSubmitModifierKeys=f;this._pendingSubmitTimeStamp=i;return}this._selectedItem?this.click(i,this._selectedItem,s,f):this.groups.length>0&&this._partialQuery.fullPartialQuery&&this.showDisableEnterMessage()},u.prototype.doubleClickGuardedHandler=function(t){var i;return function(r,u){i&&n.getCurrentDate().getTime()-i<=250||(i=n.getCurrentDate().getTime(),t(r,u))}},u.prototype.click=function(n,i,r,u){if(this._page.hideTemporaryMessage(),this.isAdvancedOption(i)){i.click&&i.click(n,r,u);return}var f=t.isGroup(i)?null:i;if(!i.instItem||f&&f.isReformulation||this._instrumentationHelper.instrumentItemClick(n,i.instItem,i.sequenceNumber,f?f.instrumentPingBack:null,r,u),!f){i.click&&i.click(n,r,u);return}u=u||this._host.getModifierKeyState();u.ctrlKey&&u.shiftKey?this.launchVerb(f,p,n):u.shiftKey?this.launchVerb(f,w,n):f.click(n,r,u);this.onSuggestionLaunch(f,this._partialQuery)},u.prototype.onSuggestionLaunch=function(n,r,u){t.isChildSuggestion(n)&&(n=n.parent);i.prototype.onSuggestionLaunch.call(this,n,r,u)},u.prototype.launchVerb=function(i,r,u){var f=vt("launchVerb",i,t.config.rawVerbs,!1,function(f){for(var h,c,o=!1,l=function(i){if(i.verb&&i.verb.toLocaleLowerCase()==r.toLocaleLowerCase())return i.executeSync?n.safeExecute(function(){return i.executeSync()},"verb.executeSync",null,r):t.Promise.safeChain("verb.executeAsync",function(){return i.executeAsync()},null,null,null,r),o=!0,"break"},e=0,s=f;e<s.length;e++)if(h=s[e],c=l(h),c==="break")break;o||i.click(u,0)},function(){return!0});f||i.click(u,0)},u.prototype.getGroupHeaderClickAction=function(i,r,u){var e=this,f,h,o,s,c;if(t.RuntimeConfig.ScopesAvailable&&(f=t.getScope(r.type),f!=t.Scope.All))return t.config.allFilesScope&&(f===t.Scope.Folders||f===t.Scope.Documents||f===t.Scope.Photos||f===t.Scope.Music||f===t.Scope.Videos)&&(f=t.Scope.AllFiles),t.isL2(i)||!t.isScopeEnabled(f,t.ScopeConfig[f])?[null,null,null]:(h=function(){return e._headerFooterViewModel.clickHandler(f,"groupHeader",r)},[h,null,null]);switch(r.type){case t.GroupType.Store:o=function(){return e._host.launchStoreSearch(i.queryToFetch)};break;case t.GroupType.SearchSuggestions:o=function(){return e.launchSearch(i,u)};break;case t.GroupType.PathCompletion:o=function(){return e._host.launchFolder(bt(i,e._partialQuery))};break;case t.GroupType.TopApps:t.config.getPopularApps&&(s=this._host.getLocString("GetPopularApps"),o=function(){return e._host.launchUri(t.config.getPopularAppsUrl)});break;case t.GroupType.ActivityFeedSuggestions:s=this._host.getLocString("OpenTimelineButtonText");o=function(){return e._host.launchUri("ms-taskswitcher://?invoketo=timeline")}}if(o){if(!u)throw"No QS code for: "+t.GroupType[r.type];return c=n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,t.SyntheticQSCodesMaps.KValues),[o,c,s]}return[null,null,null]},u.prototype.shouldShowPlusIconInGroupHeader=function(n,i){if(t.getScope(n)==t.Scope.Web||n==t.GroupType.Store)return!1;if(n==t.GroupType.Apps&&this._partialQuery.queryToFetch.length<t.config.minLengthForIBAonL1)return!0;if(n==t.GroupType.Apps||n==t.GroupType.Settings){var r=i[n==t.GroupType.Apps?"PP":"ST"];return!(r&&r.maxedOut)}return!0},u.prototype.addGroup=function(n,i,u,f,e){var o,a;if(r(this.groups,n))throw new Error("Trying to add repeated group "+n);var v=t.GroupHeaderQSCodes[n.type],c=this.getGroupHeaderClickAction(this._partialQuery,n,v),s=c[0],l=c[1],y=c[2],h=dt(this._partialQuery,this._host,n.type,i,!!s);return n.source&&(h.title+=" - "+t.getGroupSourceDisplayName(n.source,this._host)),o=[],t.isTopHitChildGroup(n)?o.push("topHitConnectedToGroup"):n.type==t.GroupType.TopApps||this._partialQuery.isSearchHomeZI&&n.type==t.GroupType.People?o.push("topItemsGroup"):n.type==t.GroupType.QuickSearch?o.push("balloonSuggGroup"):t.RuntimeConfig.QfMode==8&&(n.type==t.GroupType.Apps?o.push("appsGroup"):(n.type==t.GroupType.Documents||n.type==t.GroupType.Photos||n.type==t.GroupType.Videos||n.type==t.GroupType.Folders)&&o.push("filesGroup")),a={type:n.type,typeWithSource:n,id:"gr"+n.type+(n.source||""),text:h.title,secondaryText:y,narratorText:h.narratorText,tooltip:s?h.narratorText:null,click:s,onlyAnnotationIsClickable:s&&!!y,suggestions:[],instRegionName:t.GroupType[n.type],instItem:l,selected:!1,cssClasses:o.join(" ")||undefined,sequenceNumber:u,showPlusIconInHeader:this.shouldShowPlusIconInGroupHeader(n.type,e)},l&&this._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,v,l),this._resultsCounter.groups.push({typeWithSource:n,suggestions:[]}),this.insertGroup(a,f),a},u.prototype.insertGroup=function(n,i){for(var f,e=this,o=i.findIndex(function(i){return t.sameGroup(i,n.typeWithSource)}),u=!1,s=function(r){var f=i.findIndex(function(n){return t.sameGroup(n,e.groups[r].typeWithSource)});if(f>o)return h.groups.splice(r,0,n),u=!0,"break"},h=this,r=0;r<this.groups.length;r++)if(f=s(r),f==="break")break;u||this.groups.push(n)},u.prototype.handlePendingSubmit=function(n){if(this._pendingSubmitSequenceNumber==this._lastUpdatedSequenceNumber)try{if(this.topResults.length==0)(this.groups.length>0||n.length>0)&&this.showDisableEnterMessage();else{var t=this.topResults[0];return this._instrumentationHelper.instrumentItemClick(this._pendingSubmitTimeStamp,t.instItem,t.sequenceNumber,t.instrumentPingBack,1,this._pendingSubmitModifierKeys),this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.ctrlKey&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(t,p,this._pendingSubmitTimeStamp):this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(t,w,this._pendingSubmitTimeStamp):t.click(this._pendingSubmitTimeStamp,0,this._pendingSubmitModifierKeys),0}}finally{this.resetPendingSubmitSequenceNumber()}return 1},u.prototype.showDisableEnterMessage=function(){this._page.showTemporaryMessage(this._host.getLocString("EnterOnAmbiguousTopHitMessageText"))},u.prototype.showIndexingMessage=function(i){var r=this,u,f;t.isMobileCache||(t.config.showEnableIndexerLink&&!i?(this._turnOnIndexingInstItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem("IMIO",t.SyntheticQSCodesMaps.KValues),u={id:null,selected:null,text:this._host.getLocString("WindowsIndexingDisabledAction"),title:null,instItem:this._turnOnIndexingInstItem,click:function(n,i){var u=r._sequenceNumberReader.getSequenceNumber();u>r._lastUpdatedSequenceNumber&&r._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,"IMIO",r._turnOnIndexingInstItem);r._instrumentationHelper.instrumentItemClick(n,r._turnOnIndexingInstItem,u,null,i);t.LocalDataProvider.launchIndexingOptions(r._host,!1)},layout:1,isSelectable:!0}):this._turnOnIndexingInstItem=null,f={messageText:i?this._host.getLocString("WindowsIndexingInProgressMessage"):this._host.getLocString("WindowsIndexingDisabledMessage"),title:i?this._host.getLocString("WindowsIndexingInProgressToolTip"):this._host.getLocString("WindowsIndexingDisabledToolTip"),action:u},this._page.updateIndexingMessageView(f))},u.prototype.hideIndexingMessage=function(){t.isMobileCache||(this._turnOnIndexingInstItem=null,this._page.updateIndexingMessageView(null))},u.prototype.getAvailableSpace=function(n){var r=this,i;return t.isL2(this._partialQuery)&&this._partialQuery.queryToFetch?Number.MAX_VALUE:(i=this._page.getSuggestionsContainerHeight(),t.config.extraTopPadding&&!t.RuntimeConfig.SearchBoxOnTop&&(i-=t.config.extraTopPadding),t.RuntimeConfig.ScopesAvailable&&(i-=oi),n.topResults.length==0||t.RuntimeConfig.FlatListWithoutGroups||(i-=ti),n.topResults.forEach(function(n){return i-=pt(n,t.isL2(r._partialQuery))}),n.groups.forEach(function(n){return i-=gi(r._partialQuery,n)}),n.groups.some(function(n){return n.typeWithSource&&t.isTopHitChildGroup(n.typeWithSource)})&&n.groups.some(function(n){return n.typeWithSource&&!t.isTopHitChildGroup(n.typeWithSource)})&&(i-=ei),i)},u.prototype.getAvailableSpaceForZeroInputHomeTopSection=function(n){var f=v.textScaleFactor||1,i=this._page.getSuggestionsContainerWidth()/f,r,u;return i-=t.RuntimeConfig.AlwaysWide?si:hi,r=n.suggestions.filter(function(n){return!n.isSuppressed}).length,u=t.RuntimeConfig.AlwaysWide?ci:li,i-(u+ai)*r},u.prototype.canFitSuggestion=function(i,u,f){if(f.suppressed||u.type==t.GroupType.StartMenu||t.getTweakedSetting("scrollBarInL1"))return!0;var s=yt(this._resultsCounter),e;return i?(e={typeWithSource:u,suggestions:[]},s.groups.push(e)):e=r(s.groups,u),e.suggestions.push({mainTextWrapsToTwoLines:f&&o(f,u.type,!1),isSuppressed:f&&f.suppressed,hasTwoLines:f&&n.contains(f.classNames,"forceNoWrapOutsideTopResult")}),this._partialQuery.isSearchHomeZI?this.canFitSuggestionInZeroInputHome(e):this.getAvailableSpace(s)>=0},u.prototype.canFitSuggestionInZeroInputHome=function(n){if(kt(n.typeWithSource.type))return this.getAvailableSpaceForZeroInputHomeTopSection(n)>=0;switch(n.typeWithSource.type){case t.GroupType.QuickSearch:return!0}return n.suggestions.length<=vi},u.prototype.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup=function(){var i,r,u,n,f;if(t.isL2(this._partialQuery)&&this._partialQuery.queryToFetch||t.getTweakedSetting("scrollBarInL1"))return Number.MAX_VALUE;for(i=yt(this._resultsCounter),r=0,u=i.groups;r<u.length;r++)for(n=u[r];n.suggestions.length<t.config.minSuggestionsPerGroup;)n.suggestions.push(n.suggestions[0]);while(this.getAvailableSpace(i)>0){for(n={suggestions:[]},f=0;f<t.config.minSuggestionsPerGroup;++f)n.suggestions.push({mainTextWrapsToTwoLines:!1,isSuppressed:!1,hasTwoLines:!1});i.groups.push(n)}return i.groups.length-1},u.prototype.onSuggestionAddedToGroup=function(i,u){var e=this,f,s;this.updateNarratorWithPreviewMessage(i);t.isChildSuggestion(i)&&(i.displayed=!0,f=i.parent,i.id=f.id+"_"+f.childSuggestions.indexOf(i),t.isJumpListSuggestion(i)&&i.tooltip===undefined&&t.Promise.safeChain("getJumpListDescription",function(){return i.jumpListItem.getDescriptionAsync()},function(t){i.tooltip=t;e.groups.some(function(t){return n.contains(t.suggestions,i)})&&e.renderGroups()}));this.setRemoveIconHistorySuggestions(i);s=r(this._resultsCounter.groups,u.typeWithSource);s.suggestions.push({mainTextWrapsToTwoLines:o(i,u.typeWithSource.type,!1),isSuppressed:i.suppressed,hasTwoLines:n.contains(i.classNames,"forceNoWrapOutsideTopResult")});t.displayedInGridLayout(u.typeWithSource.type)&&u.suggestions.filter(function(n){return!n.suppressed}).length>0&&t.RuntimeConfig.QfMode!=8&&(u.cssClasses+=t.isL2(this._partialQuery)?" gridLayout":" gridLayout gridLayoutMedium")},u.prototype.onGroupsCleared=function(){this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this._resultsCounter.groups=[];this._turnOnIndexingInstItem&&this._instrumentationHelper.instrumentSyntheticInstrumentedItem(this._lastUpdatedSequenceNumber,"IMIO",this._turnOnIndexingInstItem)},u.prototype.launchSearch=function(n,t){var i=n.queryToFetch;this._host.launchSearch(i,this._navigationHelper.getSearchUrl(n.fullPartialQuery,i,t),!1)},u.prototype.setRemoveIconHistorySuggestions=function(n){var i=this,r=n.getExtraVerbs&&n.getExtraVerbs(!1).some(function(n){return n.verb=="RemoveFromDeviceHistory"}),f=n.type=="HS"&&t.config.removeSuggUrl,e=t.config.th&&ClientTestHooks.isTesthookParamSet("forceRemoveIcon"),u;(e||r||f)&&(u=r?"RemoveFromDeviceHistory":"RemoveFromWebHistory",n.removeIcon={icon:{content:"&#xE711",type:2},title:this._host.getLocString(r?"RemoveFromDeviceHistory":"RemoveFromWebHistory"),click:function(t,r){i._page.hideTemporaryMessage();i._instrumentationHelper.instrumentItemClick(t,n.instItem,n.sequenceNumber,n.instrumentPingBack,r,null,u);i.launchVerb(n,u,t);i._host.setFocusInSearchBox(null,"remove")}})},u.prototype.updateNarratorWithPreviewMessage=function(n){var r=t.RuntimeConfig.AlwaysWide?"PreviewPaneButtonNarratorMessageWidePane":"PreviewPaneButtonNarratorMessage",i=this._host.getLocString(r);n.narratorText&&n.previewPaneType&&n.narratorText.indexOf(i)==-1&&(n.narratorText+=", "+i)},u.prototype.onBeforeRenderTopResults=function(i,r,u,f){var e=this,h,c,o,l,a;this.topResults.forEach(function(n){e.setRemoveIconHistorySuggestions(n);e.updateNarratorWithPreviewMessage(n)});h=1;this.topResults.length!=1||this.topResults[0].hasChildSuggestionsDisplayed||r.some(function(n){return t.isChildSuggestion(n)})&&(this.topResults[0].hasChildSuggestionsDisplayed=!0,h=0);c=this.getSelectableItems();t.RuntimeConfig.FirstSuggestionSelectedByDefault&&(this._selectedItem&&n.contains(c,this._selectedItem)&&!this._headerFooterViewModel.isScopeElement(this._selectedItem)&&(this._selectedItem!=i[0]||this.topResults[0]==i[0])||(o=this._partialQuery.queryToFetch&&this.topResults.length>0?this.topResults[0]:null,t.config.synthWebNoBestMatch&&t.isNullOrUndefined(o)&&(l=[t.GroupType.SearchSuggestions,t.GroupType.Websites],a=r.filter(function(i){return!n.contains(l,t.getGroupType(i))}),a.length==0&&(o=r.length>0?r[0]:null)),this._previewPane&&t.RuntimeConfig.PreviewPaneAvailable&&n.safeExecute(function(){return e._previewPane.onTopHitUpdated(e._partialQuery,e._selectedItem&&e.isSuggestion(e._selectedItem)?e._selectedItem:null,o,e.getSuggestions(!1))},"ppOnTopHitUpdated"),this.select(o,!1),this._page.scrollToTop()));var v=this.topResults.length>0,s=function(n){return!n.suppressed&&(!t.config.recourseOnlyInGroups||!t.isRecourse(n))},y=v||r.some(s)||this.groups.some(function(n){return n.suggestions.some(s)})||this._pendingSuggestionsInMissingGroups.some(function(n){return n.suggestions.some(s)})||this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.some(s)});return this._headerFooterViewModel.render(this._partialQuery,v,y,u,f),h},u.prototype.isRankable=function(n){return n.typeWithSource.type!=t.GroupType.SearchSuggestions&&n.typeWithSource.type!=t.GroupType.Websites&&n.typeWithSource.type!=t.GroupType.LocalPlaces&&!n.suggestions.some(t.enforceOriginalOrder)},u.prototype.isNotRankableWithRecourse=function(n){return n.typeWithSource.type==t.GroupType.Emails},u.prototype.openPreviewPane=function(n,t){t.stopPropagation();this._previewPane.showPreview(this._partialQuery,n);this.select(n,!0);this._host.setFocusInSearchBox(null,"openPreviewPane")},u.prototype.mayNeedFlush=function(){return!t.RuntimeConfig.FlatListWithoutGroups},u.prototype.shouldRenderGroup=function(i){return t.RuntimeConfig.PreviewPaneAvailable&&t.config.suppressedGroups&&n.contains(t.config.suppressedGroups,i)?!1:!0},u.prototype.update=function(i,r,u,f,e,s,h,c,l,a){var v=this,k=this.topResults,w,d,y,it;i&&(this._contentQuery=this._partialQuery,this._renderTopResultsTimerForIcons=null,this._renderGroupsTimerForIcons=null);var tt=this.updateTopResults(i,r,u,f,e,l),ft=tt[0],et=tt[1];for(et(),this._resultsCounter.topResults=[],w=0,d=this.topResults;w<d.length;w++)y=d[w],it=1+(y.primaryMetadata?1:0)+(y.secondaryMetadata||y.stars?1:0),this._resultsCounter.topResults.push({mainTextWrapsToTwoLines:o(y,null,!0),numberOfLines:it,isHtmlAnswer:!!y.htmlContent,isSuppressed:!1,grid:t.displayedInGridLayout(y.type)});if(this._autoComplete&&this.topResults.length>0&&this._selectedItem==this.topResults[0]&&this._autoComplete.apply(this.topResults[0]),this.handlePendingSubmit(e)==0)return this.toggleProgressBar(!0),0;this._partialQuery&&this._partialQuery.isSearchHomeZI&&this.toggleProgressBar(!l);var b=!1,g=0,rt=function(){if(b&&g==0){var n=v.groups.map(function(n){return n.typeWithSource.type});v._instrumentationHelper.instrumentRenderFinished(f,h,n);b=!1}},nt=function(n,t){var r=!1,i;if(v.isRankable(t)&&v._partialQuery&&v._partialQuery.queryToFetch)for(i=0;i<t.suggestions.length;i++)if(n.rankingScore>t.suggestions[i].rankingScore){t.suggestions.splice(i,0,n);r=!0;break}r||t.suggestions.push(n);g+=1;v.setupIcon(f,n,!1,function(){g-=1;rt()});v.onSuggestionAddedToGroup(n,t)},p=this.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup()-this.groups.length,ut=function(){var i,r,n,e;if(p!=0&&u||v.flush(nt,f,c),v._partialQuery&&v._partialQuery.queryToFetch)for(v.groups.sort(function(n,i){return c.findIndex(function(i){return t.sameGroup(i,n.typeWithSource)})-c.findIndex(function(n){return t.sameGroup(n,i.typeWithSource)})}),i=0,r=v.groups;i<r.length;i++)n=r[i],v.isRankable(n)?n.suggestions.sort(function(n,t){return t.rankingScore-n.rankingScore}):v.isNotRankableWithRecourse(n)&&(e=n.suggestions.map(function(n){return n.notAResult}).findIndex(function(n){return n}),e!=-1&&n.suggestions.splice(n.suggestions.length-1,0,n.suggestions.splice(e,1)[0])),v.populateGroupHeaderFlags(n)};return i||e.length>0||s.length>0?(this.renderGroupsAfter(function(){for(var ot,h,l,g,tt,y,it,w,rt,r,b,et,o=0,d=s;o<d.length;o++)r=d[o],ot=v.removeSuggestion(r,a),ot&&(p+=1);for(h=function(n,i){var e=v.getGroupData(n),u=e[0],r=e[1],o;v.shouldRenderGroup(u.type)&&(r?(r.count&&r.count++,o=t.config.minSuggestionsPerGroup&&!i?t.config.minSuggestionsPerGroup-r.suggestions.length:999,o>0&&v.canFitSuggestion(!1,u,n)?nt(n,r):v._partialQuery.isSearchHomeZI||v.queueSuggestionInExistingGroup(n,r)):p>0&&v.canFitSuggestion(!0,u,n)?(r=v.addGroup(u,n,f,c,a),v.shouldTrackGroupCount(r)&&(r.count=1),nt(n,r),p-=1):v._partialQuery.isSearchHomeZI||v.queueSuggestionInMissingGroup(n,u,a))},l=0,g=k;l<g.length;l++){var st=g[l],ht=v.getGroupData(st),u=ht[1];u&&u.count&&(u.count-=1)}if(tt=function(){return v._contentQuery.isSearchHomeZI||t.shouldFetchStartMenu(v._contentQuery)||t.getTweakedSetting("scrollBarInL1")},ft&&!i){for(y=0,it=e;y<it.length;y++)r=it[y],n.contains(k,r)&&h(r,!0);for(w=0,rt=e;w<rt.length;w++)r=rt[w],n.contains(k,r)||h(r,tt())}else e.forEach(function(n){return h(n,tt())});for(b=0,et=v.topResults;b<et.length;b++){var st=et[b],ct=v.getGroupData(st),u=ct[1];u&&u.count&&(u.count+=1)}ut()}),b=!0):p!=0&&u||(this._pendingSuggestionsInMissingGroups.some(function(n){return n.suggestions.length>0})||this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))&&(this.renderGroupsAfter(function(){return ut()}),b=!0),rt(),l&&this.toggleProgressBar(!1),1},u.prototype.populateGroupHeaderFlags=function(n){if(t.canGoToL2(n)){var i=n.suggestions.every(function(n){return n.suppressed});n.showCountInHeader=i}},u.prototype.shouldTrackGroupCount=function(n){return t.canGoToL2(n)},u.prototype.getGroupData=function(n){var i={type:t.getGroupType(n),source:n.sourceForGroup};return[i,r(this.groups,i)]},u.prototype.removePendingSuggestionFromExistingGroup=function(n,t){for(var r,u,i=0;i<this._pendingSuggestionsInExistingGroups.length;++i)if(r=this._pendingSuggestionsInExistingGroups[i],r.group==t)if(u=r.suggestions.indexOf(n),u==-1)throw new Error("Pending suggestion not found");else{r.suggestions.splice(u,1);r.suggestions.length==0&&this._pendingSuggestionsInExistingGroups.splice(i,1);return}throw new Error("Pending suggestion not found");},u.prototype.removePendingSuggestionFromMissingGroup=function(n,i){for(var u,f,r=0;r<this._pendingSuggestionsInMissingGroups.length;++r)if(u=this._pendingSuggestionsInMissingGroups[r],t.sameGroup(u.typeWithSource,i))if(f=u.suggestions.indexOf(n),f==-1)throw new Error("Pending suggestion not found");else{u.suggestions.splice(f,1);u.suggestions.length==0&&this._pendingSuggestionsInMissingGroups.splice(r,1);return}throw new Error("Pending suggestion not found");},u.prototype.queueSuggestionInExistingGroup=function(n,t){var i=wt(this._pendingSuggestionsInExistingGroups,t.typeWithSource);i?i.suggestions.push(n):(i={group:t,suggestions:[n]},this._pendingSuggestionsInExistingGroups.push(i))},u.prototype.queueSuggestionInMissingGroup=function(n,t,i){var u=r(this._pendingSuggestionsInMissingGroups,t);u?u.suggestions.push(n):(u={typeWithSource:t,suggestions:[n],extraSignalsMap:i},this._pendingSuggestionsInMissingGroups.push(u))},u.prototype.partialFlush=function(n,t,i,r){while(n>0&&i.length>0){var u=i[0];this.canFitSuggestion(!1,t.typeWithSource,u)&&r(u,t);i.splice(0,1);n-=1}},u.prototype.flush=function(n,i,r){for(var e,s,u,c,l=this,a=function(u){var o=u.suggestions[0],e;o&&f.canFitSuggestion(!0,u.typeWithSource,o)&&(e=f.addGroup(u.typeWithSource,o,i,r,u.extraSignalsMap),f.shouldTrackGroupCount(e)&&(e.count=u.suggestions.length),f.partialFlush(t.config.minSuggestionsPerGroup,e,u.suggestions,n),u.suggestions.forEach(function(n){return l.queueSuggestionInExistingGroup(n,e)}),u.suggestions=[])},f=this,o=0,h=this._pendingSuggestionsInMissingGroups;o<h.length;o++)u=h[o],a(u);while(this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))for(e=0,s=this._pendingSuggestionsInExistingGroups;e<s.length;e++)u=s[e],c=t.config.minSuggestionsPerGroup?1:u.suggestions.length,this.partialFlush(c,u.group,u.suggestions,n)},u.prototype.removeSuggestion=function(i,u){var h={type:t.getGroupType(i),source:i.sourceForGroup},f=r(this.groups,h),e,c,s;if(f)if(n.tryRemove(f.suggestions,i)){if(e=r(this._resultsCounter.groups,f.typeWithSource),c=o(i,f.typeWithSource.type,!1),n.removeFirstWhere(e.suggestions,function(n){return n.mainTextWrapsToTwoLines==c}),t.displayedInGridLayout(f.typeWithSource.type)&&f.suggestions.filter(function(n){return!n.suppressed}).length==0&&(f.cssClasses=""),f.suggestions.length==0)return n.tryRemove(this.groups,f),this._resultsCounter.groups=this._resultsCounter.groups.filter(function(n){return n!=e}),s=wt(this._pendingSuggestionsInExistingGroups,f.typeWithSource),s&&this._pendingSuggestionsInMissingGroups.push({typeWithSource:f.typeWithSource,suggestions:s.suggestions,extraSignalsMap:u}),!0}else this.removePendingSuggestionFromExistingGroup(i,f);else this.removePendingSuggestionFromMissingGroup(i,h);return!1},u}(n.BaseRootViewModel);t.RootViewModel=gt})(t=n.WSB||(n.WSB={}))})(AutoSuggest||(AutoSuggest={}))